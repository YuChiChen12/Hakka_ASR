#!/bin/bash
#SBATCH --job-name="T2_d2_ckpt21000_test"
#SBATCH --partition=a100-al9
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=1
#SBATCH --gres=gpu:2
#SBATCH --cpus-per-task=8
#SBATCH --time=1-00:00:00
#SBATCH --mem=16G
#SBATCH --output=logs/%x_%j.out
#SBATCH --error=logs/%x_%j.err

CONDA_ENV_NAME="hakka_asr"
TRACK=2
TEST_DATA=2
CKPT="checkpoint-21000"
TEST_RESULT="result/test/track$TRACK/$TEST_DATA_$CKPT.csv"

mkdir -p data logs result/test/track1 result/test/track2

module load anaconda3/2024.10-1
eval "$(conda shell.bash hook)"
conda activate "$CONDA_ENV_NAME"

export HOME=/ceph/work/KLP/yuchi/Hakka_ASR && cd
export PATH="$HOME/.local/bin:$PATH"
export TMPDIR="$HOME/.tmp"

# python test.py --model_path "hakka_asr_models/track$TRACK/$CKPT" --csv_path "data/dataset_$TEST_DATA.csv" --output_file "$TEST_RESULT" --verbose
python test.py --model_path "chi-gs12/Hakka_ASR/track$TRACK/$CKPT" --track "track$TRACK" --csv_path "data/dataset_${TEST_DATA}_with_note.csv" --output_file "$TEST_RESULT" --verbose
